import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{B as de,K as ue,p as P,a as L,b as W,m as q,c as o,s as f,g as r,r as s,t as G,n as U,d as H,f as ve,ad as oe,aq as ae,ae as re}from"../chunks/PWWI3Ue3.js";import{t as D,a as _,s as K,e as M,b as fe,c as he}from"../chunks/BC15lkC2.js";import{i as N}from"../chunks/BEc5jUYy.js";import{p as R}from"../chunks/LNgpw9vD.js";import{a as ie,s as Y}from"../chunks/6avubi_o.js";import{o as F,c as me,a as ne}from"../chunks/D93VaLay.js";import{g as O}from"../chunks/C5OadaZi.js";import{i as j}from"../chunks/BsCQza_p.js";import{s as se}from"../chunks/CjOiFDoo.js";import{w as te,d as pe}from"../chunks/CNzxuJyc.js";import{n as ge,m as be,f as ye}from"../chunks/DXySWGYQ.js";import{t as ee,f as le,a as xe}from"../chunks/CtkfvfXh.js";import{e as we}from"../chunks/FrGZEVpv.js";import{p as _e,n as ke,m as Te,i as Se,b as De}from"../chunks/BIOqlViq.js";import{s as Ce}from"../chunks/DBYvBCBS.js";import{g as Ie}from"../chunks/BcYMahjX.js";function Ae(k,l,e,n,m){var d;de&&ue();var u=(d=l.$$slots)==null?void 0:d[e],c=!1;u===!0&&(u=l.children,c=!0),u===void 0||u(k,c?()=>n:n)}const B=te(!1);var $e=D('<nav class="flex space-x-4"><a href="/" class="rounded px-3 py-2 hover:bg-gray-100">Home</a> <a href="/groups" class="rounded px-3 py-2 hover:bg-gray-100">Show Groups</a> <a href="/groups/create" class="rounded px-3 py-2 hover:bg-gray-100">Create Group</a> <a href="/notifications" class="rounded px-3 py-2 hover:bg-gray-100">Notifications</a></nav>'),Ke=D('<div class="h-10 w-36 animate-pulse rounded bg-gray-200"></div>'),je=D('<img class="h-full w-full object-cover">'),Me=D('<div class="flex items-center gap-3"><button class="flex h-8 w-8 items-center justify-center rounded-full border border-gray-300 bg-white text-gray-600 hover:bg-gray-100" title="Keyboard Shortcuts" aria-label="Show keyboard shortcuts"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></button> <a href="/profile" class="flex items-center gap-2"><div class="flex h-10 w-10 items-center justify-center overflow-hidden rounded-full bg-black text-white"><!></div> <span> </span></a> <button class="rounded border border-gray-300 bg-white px-3 py-1 text-sm hover:bg-gray-100">Logout</button></div>'),Pe=D('<div class="flex gap-2"><button class="flex h-8 w-8 items-center justify-center rounded-full border border-gray-300 bg-white text-gray-600 hover:bg-gray-100" title="Keyboard Shortcuts" aria-label="Show keyboard shortcuts"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></button> <a href="/auth/login" class="rounded border border-gray-300 bg-white px-4 py-2 text-sm hover:bg-gray-100">Log In</a> <a href="/auth/signup" class="rounded bg-black px-4 py-2 text-sm text-white hover:bg-gray-800">Sign Up</a></div>'),Le=D('<header class="border-b border-gray-200 bg-white p-4"><div class="container mx-auto flex items-center justify-between"><div class="flex items-center"><h1 class="mr-6 text-xl font-bold">To-Do App</h1> <!></div> <!></div></header>');function Ne(k,l){P(l,!1);let e=q(null),n=q(!0);F(async()=>{try{const a=await fetch("/api/auth/me");a.ok&&W(e,await a.json())}catch(a){console.error("Error fetching user:",a)}finally{W(n,!1)}});async function m(){try{(await fetch("/api/auth/logout",{method:"POST"})).ok&&(W(e,null),O("/auth/login"))}catch(a){console.error("Error logging out:",a)}}function u(){B.set(!0)}N();var c=Le(),d=o(c),i=o(d),t=f(o(i),2);{var v=a=>{var x=$e();_(a,x)};j(t,a=>{r(e)&&!r(n)&&a(v)})}s(i);var g=f(i,2);{var p=a=>{var x=Ke();_(a,x)},y=(a,x)=>{{var T=w=>{var h=Me(),C=o(h),E=f(C,2),$=o(E),J=o($);{var X=S=>{var A=je();G(()=>{se(A,"src",r(e).profileImage),se(A,"alt",r(e).username)}),_(S,A)},Z=S=>{var A=fe();G(V=>K(A,V),[()=>r(e).profileImage||r(e).username.charAt(0).toUpperCase()],H),_(S,A)};j(J,S=>{r(e).profileImage&&r(e).profileImage.length>2?S(X):S(Z,!1)})}s($);var z=f($,2),Q=o(z,!0);s(z),s(E);var b=f(E,2);s(h),G(()=>K(Q,r(e).username)),M("click",C,u),M("click",b,m),_(w,h)},I=w=>{var h=Pe(),C=o(h);U(4),s(h),M("click",C,u),_(w,h)};j(a,w=>{r(e)?w(T):w(I,!1)},x)}};j(g,a=>{r(n)?a(p):a(y,!1)})}s(d),s(c),_(k,c),L()}function Ee(k,l){P(l,!1);let e=!1;F(()=>(e=/Mac|iPod|iPhone|iPad/.test(navigator.platform),window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}));function n(m){if(e?m.metaKey:m.ctrlKey)switch(m.key.toLowerCase()){case"g":m.preventDefault(),O("/groups/create");break;case"m":m.preventDefault(),O("/");break;case"z":m.preventDefault(),O("/profile");break}}N(),L()}var ze=D('<div class="shortcuts-tooltip svelte-swh80v"><div class="tooltip-content svelte-swh80v"><h3 class="svelte-swh80v">Keyboard Shortcuts</h3> <ul class="svelte-swh80v"><li class="svelte-swh80v"><kbd class="svelte-swh80v"></kbd> - Create Group</li> <li class="svelte-swh80v"><kbd class="svelte-swh80v"></kbd> - Personal Todos</li> <li class="svelte-swh80v"><kbd class="svelte-swh80v"></kbd> - Profile Page</li></ul> <button class="close-btn svelte-swh80v" aria-label="Close shortcuts">Ã—</button></div></div>');function Be(k,l){P(l,!1);const[e,n]=ie(),m=()=>Y(B,"$showShortcutsTooltip",e);let u=!1;F(()=>{u=/Mac|iPod|iPhone|iPad/.test(navigator.platform),B.set(!0),setTimeout(()=>{B.set(!1)},5e3)});const c=u?"âŒ˜":"Ctrl";N();var d=he(),i=ve(d);{var t=v=>{var g=ze(),p=o(g),y=f(o(p),2),a=o(y),x=o(a);x.textContent=`${c} + G`,U(),s(a);var T=f(a,2),I=o(T);I.textContent=`${c} + M`,U(),s(T);var w=f(T,2),h=o(w);h.textContent=`${c} + Z`,U(),s(w),s(y);var C=f(y,2);s(p),s(g),M("click",C,()=>B.set(!1)),ee(3,g,()=>le),_(v,g)};j(i,v=>{m()&&v(t)})}_(k,d),L(),n()}var We=D('<details class="mt-2 text-xs text-gray-400"><summary>Debug info</summary> <pre class="max-h-24 overflow-auto rounded bg-gray-50 p-1"> </pre></details>'),Ge=D('<div class="fixed top-4 right-4 z-50 w-full max-w-sm overflow-hidden rounded-lg bg-white shadow-lg"><div class="p-4"><div class="flex items-start"><div class="flex-shrink-0"><div><span class="text-lg"> </span></div></div> <div class="ml-3 w-0 flex-1 pt-0.5"><p class="text-sm font-medium text-gray-900"> </p> <p class="mt-1 text-sm text-gray-500"> </p> <!></div> <div class="ml-4 flex flex-shrink-0"><button type="button" class="inline-flex text-gray-400 hover:text-gray-500 focus:ring-2 focus:ring-black focus:ring-offset-2 focus:outline-none"><span class="sr-only">Close</span> <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div></div></div></div>');function Re(k,l){P(l,!1);let e=R(l,"notification",8),n=R(l,"duration",8,5e3),m=R(l,"showDebugInfo",8,!1);const u=me(),c=window.location.hostname==="localhost";let d=q();c&&e()&&console.log("Rendering notification toast:",e());function i(){clearTimeout(r(d))}function t(){clearTimeout(r(d)),u("dismiss",{id:e().id||e()._id,type:e().type})}function v(b){switch(b){case"group:invited":return"âœ‰ï¸";case"group:joined":return"ðŸ‘¥";case"todo:added":return"âž•";case"todo:updated":return"âœï¸";case"todo:deleted":return"ðŸ—‘ï¸";case"todo:completed":return"âœ…";default:return"ðŸ””"}}function g(b){return b.startsWith("group:")||b==="todo:added"||b==="todo:updated"?"text-black":b==="todo:deleted"?"text-red-500":b==="todo:completed"?"text-black":"text-gray-500"}_e(),oe(()=>(ae(e()),ae(n()),r(d)),()=>{e()&&n()>0&&(clearTimeout(r(d)),W(d,setTimeout(()=>{u("dismiss",{id:e().id||e()._id})},n())))}),re(),N();var p=Ge(),y=o(p),a=o(y),x=o(a),T=o(x),I=o(T),w=o(I,!0);s(I),s(T),s(x);var h=f(x,2),C=o(h),E=o(C,!0);s(C);var $=f(C,2),J=o($,!0);s($);var X=f($,2);{var Z=b=>{var S=We(),A=f(o(S),2),V=o(A,!0);s(A),s(S),G(ce=>K(V,ce),[()=>JSON.stringify(e(),null,2)],H),_(b,S)};j(X,b=>{c&&m()&&b(Z)})}s(h);var z=f(h,2),Q=o(z);s(z),s(a),s(y),s(p),G((b,S)=>{Ce(T,1,b),K(w,S),K(E,e().title),K(J,e().message)},[()=>`inline-flex h-8 w-8 items-center justify-center rounded-full ${g(e().type)}`,()=>v(e().type)],H),M("click",Q,t),ee(1,p,()=>xe,()=>({x:20,duration:300})),ee(2,p,()=>le,()=>({duration:200})),M("outroend",p,i),_(k,p),L()}var Ue=D('<div class="notifications-container z-50 space-y-4 svelte-nmdgto"></div>');function Oe(k,l){P(l,!1);let e=R(l,"maxToasts",8,3),n=q([]);const u=pe([ke,ge],([i,t])=>{const v=[...i,...t].sort((g,p)=>{const y=new Date(g.timestamp||g.createdAt||Date.now());return new Date(p.timestamp||p.createdAt||Date.now()).getTime()-y.getTime()});return console.log("Combined notifications:",v.length),v}).subscribe(i=>{const t=i.filter(v=>!v.read);console.log("Unread notifications:",t.length),W(n,t.slice(0,e()))});function c(i){const{id:t,type:v}=i.detail;t.startsWith("todo_")||t.startsWith("inv_")||t.startsWith("role_")||t.startsWith("rem_")||t.startsWith("join_")?Te(t):be(t)}ne(()=>{u()}),oe(()=>r(n),()=>{r(n).length>0&&console.log("Active toasts:",r(n))}),re(),N();var d=Ue();we(d,5,()=>r(n),i=>i.id||i._id,(i,t)=>{const v=H(()=>({id:r(t).id||r(t)._id,type:r(t).type,title:r(t).title||"Notification",message:r(t).message,data:r(t).data||{}}));Re(i,{get notification(){return r(v)},$$events:{dismiss:c}})}),s(d),_(k,d),L()}const qe=te(null),He=te(!1);var Fe=D('<div class="app svelte-p35luu"><!> <main class="svelte-p35luu"><!></main> <!> <!> <!></div>');function vt(k,l){P(l,!1);const[e,n]=ie(),m=()=>Y(He,"$isAuthenticated",e),u=()=>Y(qe,"$user",e);R(l,"data",8);let c=0;const d=3;let i=null;F(async()=>{var T;if(!(!m()||!((T=u())!=null&&T._id)))try{const w=(await Ie()).map(h=>h._id);Se(u()._id,w),ye().catch(h=>console.error("Failed to fetch initial notifications:",h))}catch(I){console.error("Error initializing socket:",I),c<d&&(c++,i&&clearTimeout(i),i=setTimeout(()=>{console.log(`Retrying socket initialization (attempt ${c})`)},3e3*c))}}),ne(()=>{i&&clearTimeout(i),De()}),N();var t=Fe(),v=o(t);Ne(v,{});var g=f(v,2),p=o(g);Ae(p,l,"default",{}),s(g);var y=f(g,2);Ee(y,{});var a=f(y,2);Be(a,{});var x=f(a,2);Oe(x,{}),s(t),_(k,t),L(),n()}export{vt as component};
